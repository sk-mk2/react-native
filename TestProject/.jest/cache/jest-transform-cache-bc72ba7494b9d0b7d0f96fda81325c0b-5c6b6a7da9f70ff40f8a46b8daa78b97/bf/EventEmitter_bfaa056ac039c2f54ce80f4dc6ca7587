16579fc0aeca96443983fc767540b630
'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var EmitterSubscription=require('EmitterSubscription');var EventSubscriptionVendor=require('EventSubscriptionVendor');var emptyFunction=require('fbjs/lib/emptyFunction');var invariant=require('fbjs/lib/invariant');var EventEmitter=function(){function EventEmitter(subscriber){_classCallCheck(this,EventEmitter);this._subscriber=subscriber||new EventSubscriptionVendor();}_createClass(EventEmitter,[{key:'addListener',value:function addListener(eventType,listener,context){return this._subscriber.addSubscription(eventType,new EmitterSubscription(this,this._subscriber,listener,context));}},{key:'once',value:function once(eventType,listener,context){var _this=this;return this.addListener(eventType,function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this.removeCurrentListener();listener.apply(context,args);});}},{key:'removeAllListeners',value:function removeAllListeners(eventType){this._subscriber.removeAllSubscriptions(eventType);}},{key:'removeCurrentListener',value:function removeCurrentListener(){invariant(!!this._currentSubscription,'Not in an emitting cycle; there is no current subscription');this.removeSubscription(this._currentSubscription);}},{key:'removeSubscription',value:function removeSubscription(subscription){invariant(subscription.emitter===this,'Subscription does not belong to this emitter.');this._subscriber.removeSubscription(subscription);}},{key:'listeners',value:function listeners(eventType){var subscriptions=this._subscriber.getSubscriptionsForType(eventType);return subscriptions?subscriptions.filter(emptyFunction.thatReturnsTrue).map(function(subscription){return subscription.listener;}):[];}},{key:'emit',value:function emit(eventType){var subscriptions=this._subscriber.getSubscriptionsForType(eventType);if(subscriptions){for(var i=0,l=subscriptions.length;i<l;i++){var subscription=subscriptions[i];if(subscription){this._currentSubscription=subscription;subscription.listener.apply(subscription.context,Array.prototype.slice.call(arguments,1));}}this._currentSubscription=null;}}},{key:'removeListener',value:function removeListener(eventType,listener){var subscriptions=this._subscriber.getSubscriptionsForType(eventType);if(subscriptions){for(var i=0,l=subscriptions.length;i<l;i++){var subscription=subscriptions[i];if(subscription&&subscription.listener===listener){subscription.remove();}}}}}]);return EventEmitter;}();module.exports=EventEmitter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV2ZW50RW1pdHRlci5qcyJdLCJuYW1lcyI6WyJFbWl0dGVyU3Vic2NyaXB0aW9uIiwicmVxdWlyZSIsIkV2ZW50U3Vic2NyaXB0aW9uVmVuZG9yIiwiZW1wdHlGdW5jdGlvbiIsImludmFyaWFudCIsIkV2ZW50RW1pdHRlciIsInN1YnNjcmliZXIiLCJfc3Vic2NyaWJlciIsImV2ZW50VHlwZSIsImxpc3RlbmVyIiwiY29udGV4dCIsImFkZFN1YnNjcmlwdGlvbiIsImFkZExpc3RlbmVyIiwiYXJncyIsInJlbW92ZUN1cnJlbnRMaXN0ZW5lciIsImFwcGx5IiwicmVtb3ZlQWxsU3Vic2NyaXB0aW9ucyIsIl9jdXJyZW50U3Vic2NyaXB0aW9uIiwicmVtb3ZlU3Vic2NyaXB0aW9uIiwic3Vic2NyaXB0aW9uIiwiZW1pdHRlciIsInN1YnNjcmlwdGlvbnMiLCJnZXRTdWJzY3JpcHRpb25zRm9yVHlwZSIsImZpbHRlciIsInRoYXRSZXR1cm5zVHJ1ZSIsIm1hcCIsImkiLCJsIiwibGVuZ3RoIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJzbGljZSIsImNhbGwiLCJhcmd1bWVudHMiLCJyZW1vdmUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFVQSxhLCtvQkFFQSxHQUFNQSxxQkFBc0JDLE9BQXRCLHVCQUFOLENBQ0EsR0FBTUMseUJBQTBCRCxPQUExQiwyQkFBTixDQUVBLEdBQU1FLGVBQWdCRixPQUFoQiwwQkFBTixDQUNBLEdBQU1HLFdBQVlILE9BQVosc0JBQU4sQyxHQWVNSSxhLFlBV0osc0JBQVlDLFVBQVosQ0FBa0Qsb0NBQ2hELEtBQUtDLFdBQUwsQ0FBbUJELFlBQWMsR0FBSUosd0JBQUosRUFBakMsQ0FDRCxDLHlFQWlCQ00sUyxDQUFtQkMsUSxDQUFvQkMsTyxDQUF1QyxDQUU5RSxNQUFRLE1BQUtILFdBQUwsQ0FBaUJJLGVBQWpCLENBQ05ILFNBRE0sQ0FFTixHQUFJUixvQkFBSixDQUF3QixJQUF4QixDQUE4QixLQUFLTyxXQUFuQyxDQUFnREUsUUFBaEQsQ0FBMERDLE9BQTFELENBRk0sQ0FBUixDQUlELEMsa0NBWUlGLFMsQ0FBbUJDLFEsQ0FBb0JDLE8sQ0FBdUMsZ0JBQ2pGLE1BQU8sTUFBS0UsV0FBTCxDQUFpQkosU0FBakIsQ0FBNEIsVUFBYSwrQkFBVEssSUFBUyxzQ0FBVEEsSUFBUyx3QkFDOUMsTUFBS0MscUJBQUwsR0FDQUwsU0FBU00sS0FBVCxDQUFlTCxPQUFmLENBQXdCRyxJQUF4QixFQUNELENBSE0sQ0FBUCxDQUlELEMsOERBU2tCTCxTLENBQW9CLENBQ3JDLEtBQUtELFdBQUwsQ0FBaUJTLHNCQUFqQixDQUF3Q1IsU0FBeEMsRUFDRCxDLHFFQXVCdUIsQ0FDdEJKLFVBQ0UsQ0FBQyxDQUFDLEtBQUthLG9CQURULENBRUUsNERBRkYsRUFJQSxLQUFLQyxrQkFBTCxDQUF3QixLQUFLRCxvQkFBN0IsRUFDRCxDLDhEQU1rQkUsWSxDQUFtQyxDQUNwRGYsVUFDRWUsYUFBYUMsT0FBYixHQUF5QixJQUQzQixDQUVFLCtDQUZGLEVBSUEsS0FBS2IsV0FBTCxDQUFpQlcsa0JBQWpCLENBQW9DQyxZQUFwQyxFQUNELEMsNENBU1NYLFMsQ0FBMEMsQ0FDbEQsR0FBTWEsZUFBeUMsS0FBS2QsV0FBTCxDQUFpQmUsdUJBQWpCLENBQXlDZCxTQUF6QyxDQUEvQyxDQUNBLE1BQU9hLGVBQ0hBLGNBQWNFLE1BQWQsQ0FBcUJwQixjQUFjcUIsZUFBbkMsRUFBb0RDLEdBQXBELENBQ0UsU0FBU04sWUFBVCxDQUF1QixDQUNyQixNQUFPQSxjQUFhVixRQUFwQixDQUNELENBSEgsQ0FERyxDQUtILEVBTEosQ0FNRCxDLGtDQWdCSUQsUyxDQUFtQixDQUN0QixHQUFNYSxlQUF5QyxLQUFLZCxXQUFMLENBQWlCZSx1QkFBakIsQ0FBeUNkLFNBQXpDLENBQS9DLENBQ0EsR0FBSWEsYUFBSixDQUFtQixDQUNqQixJQUFLLEdBQUlLLEdBQUksQ0FBUixDQUFXQyxFQUFJTixjQUFjTyxNQUFsQyxDQUEwQ0YsRUFBSUMsQ0FBOUMsQ0FBaURELEdBQWpELENBQXNELENBQ3BELEdBQU1QLGNBQWVFLGNBQWNLLENBQWQsQ0FBckIsQ0FHQSxHQUFJUCxZQUFKLENBQWtCLENBQ2hCLEtBQUtGLG9CQUFMLENBQTRCRSxZQUE1QixDQUNBQSxhQUFhVixRQUFiLENBQXNCTSxLQUF0QixDQUNFSSxhQUFhVCxPQURmLENBRUVtQixNQUFNQyxTQUFOLENBQWdCQyxLQUFoQixDQUFzQkMsSUFBdEIsQ0FBMkJDLFNBQTNCLENBQXNDLENBQXRDLENBRkYsRUFJRCxDQUNGLENBQ0QsS0FBS2hCLG9CQUFMLENBQTRCLElBQTVCLENBQ0QsQ0FDRixDLHNEQWVjVCxTLENBQW1CQyxRLENBQVUsQ0FDMUMsR0FBTVksZUFBeUMsS0FBS2QsV0FBTCxDQUFpQmUsdUJBQWpCLENBQXlDZCxTQUF6QyxDQUEvQyxDQUNBLEdBQUlhLGFBQUosQ0FBbUIsQ0FDakIsSUFBSyxHQUFJSyxHQUFJLENBQVIsQ0FBV0MsRUFBSU4sY0FBY08sTUFBbEMsQ0FBMENGLEVBQUlDLENBQTlDLENBQWlERCxHQUFqRCxDQUFzRCxDQUNwRCxHQUFNUCxjQUFlRSxjQUFjSyxDQUFkLENBQXJCLENBSUEsR0FBSVAsY0FBZ0JBLGFBQWFWLFFBQWIsR0FBMEJBLFFBQTlDLENBQXdELENBQ3REVSxhQUFhZSxNQUFiLEdBQ0QsQ0FDRixDQUNGLENBQ0YsQyw0QkFHSEMsT0FBT0MsT0FBUCxDQUFpQi9CLFlBQWpCIiwiZmlsZSI6IkV2ZW50RW1pdHRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIEV2ZW50RW1pdHRlclxuICogQG5vZmxvd1xuICogQHR5cGVjaGVja1xuICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEVtaXR0ZXJTdWJzY3JpcHRpb24gPSByZXF1aXJlKCdFbWl0dGVyU3Vic2NyaXB0aW9uJyk7XG5jb25zdCBFdmVudFN1YnNjcmlwdGlvblZlbmRvciA9IHJlcXVpcmUoJ0V2ZW50U3Vic2NyaXB0aW9uVmVuZG9yJyk7XG5cbmNvbnN0IGVtcHR5RnVuY3Rpb24gPSByZXF1aXJlKCdmYmpzL2xpYi9lbXB0eUZ1bmN0aW9uJyk7XG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdmYmpzL2xpYi9pbnZhcmlhbnQnKTtcblxuLyoqXG4gKiBAY2xhc3MgRXZlbnRFbWl0dGVyXG4gKiBAZGVzY3JpcHRpb25cbiAqIEFuIEV2ZW50RW1pdHRlciBpcyByZXNwb25zaWJsZSBmb3IgbWFuYWdpbmcgYSBzZXQgb2YgbGlzdGVuZXJzIGFuZCBwdWJsaXNoaW5nXG4gKiBldmVudHMgdG8gdGhlbSB3aGVuIGl0IGlzIHRvbGQgdGhhdCBzdWNoIGV2ZW50cyBoYXBwZW5lZC4gSW4gYWRkaXRpb24gdG8gdGhlXG4gKiBkYXRhIGZvciB0aGUgZ2l2ZW4gZXZlbnQgaXQgYWxzbyBzZW5kcyBhIGV2ZW50IGNvbnRyb2wgb2JqZWN0IHdoaWNoIGFsbG93c1xuICogdGhlIGxpc3RlbmVycy9oYW5kbGVycyB0byBwcmV2ZW50IHRoZSBkZWZhdWx0IGJlaGF2aW9yIG9mIHRoZSBnaXZlbiBldmVudC5cbiAqXG4gKiBUaGUgZW1pdHRlciBpcyBkZXNpZ25lZCB0byBiZSBnZW5lcmljIGVub3VnaCB0byBzdXBwb3J0IGFsbCB0aGUgZGlmZmVyZW50XG4gKiBjb250ZXh0cyBpbiB3aGljaCBvbmUgbWlnaHQgd2FudCB0byBlbWl0IGV2ZW50cy4gSXQgaXMgYSBzaW1wbGUgbXVsdGljYXN0XG4gKiBtZWNoYW5pc20gb24gdG9wIG9mIHdoaWNoIGV4dHJhIGZ1bmN0aW9uYWxpdHkgY2FuIGJlIGNvbXBvc2VkLiBGb3IgZXhhbXBsZSwgYVxuICogbW9yZSBhZHZhbmNlZCBlbWl0dGVyIG1heSB1c2UgYW4gRXZlbnRIb2xkZXIgYW5kIEV2ZW50RmFjdG9yeS5cbiAqL1xuY2xhc3MgRXZlbnRFbWl0dGVyIHtcblxuICBfc3Vic2NyaWJlcjogRXZlbnRTdWJzY3JpcHRpb25WZW5kb3I7XG4gIF9jdXJyZW50U3Vic2NyaXB0aW9uOiA/RW1pdHRlclN1YnNjcmlwdGlvbjtcblxuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqXG4gICAqIEBwYXJhbSB7RXZlbnRTdWJzY3JpcHRpb25WZW5kb3J9IHN1YnNjcmliZXIgLSBPcHRpb25hbCBzdWJzY3JpYmVyIGluc3RhbmNlXG4gICAqICAgdG8gdXNlLiBJZiBvbWl0dGVkLCBhIG5ldyBzdWJzY3JpYmVyIHdpbGwgYmUgY3JlYXRlZCBmb3IgdGhlIGVtaXR0ZXIuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihzdWJzY3JpYmVyOiA/RXZlbnRTdWJzY3JpcHRpb25WZW5kb3IpIHtcbiAgICB0aGlzLl9zdWJzY3JpYmVyID0gc3Vic2NyaWJlciB8fCBuZXcgRXZlbnRTdWJzY3JpcHRpb25WZW5kb3IoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgbGlzdGVuZXIgdG8gYmUgaW52b2tlZCB3aGVuIGV2ZW50cyBvZiB0aGUgc3BlY2lmaWVkIHR5cGUgYXJlXG4gICAqIGVtaXR0ZWQuIEFuIG9wdGlvbmFsIGNhbGxpbmcgY29udGV4dCBtYXkgYmUgcHJvdmlkZWQuIFRoZSBkYXRhIGFyZ3VtZW50c1xuICAgKiBlbWl0dGVkIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBsaXN0ZW5lciBmdW5jdGlvbi5cbiAgICpcbiAgICogVE9ETzogQW5ub3RhdGUgdGhlIGxpc3RlbmVyIGFyZydzIHR5cGUuIFRoaXMgaXMgdHJpY2t5IGJlY2F1c2UgbGlzdGVuZXJzXG4gICAqICAgICAgIGNhbiBiZSBpbnZva2VkIHdpdGggdmFyYXJncy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50VHlwZSAtIE5hbWUgb2YgdGhlIGV2ZW50IHRvIGxpc3RlbiB0b1xuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBsaXN0ZW5lciAtIEZ1bmN0aW9uIHRvIGludm9rZSB3aGVuIHRoZSBzcGVjaWZpZWQgZXZlbnQgaXNcbiAgICogICBlbWl0dGVkXG4gICAqIEBwYXJhbSB7Kn0gY29udGV4dCAtIE9wdGlvbmFsIGNvbnRleHQgb2JqZWN0IHRvIHVzZSB3aGVuIGludm9raW5nIHRoZVxuICAgKiAgIGxpc3RlbmVyXG4gICAqL1xuICBhZGRMaXN0ZW5lcihcbiAgICBldmVudFR5cGU6IHN0cmluZywgbGlzdGVuZXI6IEZ1bmN0aW9uLCBjb250ZXh0OiA/T2JqZWN0KTogRW1pdHRlclN1YnNjcmlwdGlvbiB7XG5cbiAgICByZXR1cm4gKHRoaXMuX3N1YnNjcmliZXIuYWRkU3Vic2NyaXB0aW9uKFxuICAgICAgZXZlbnRUeXBlLFxuICAgICAgbmV3IEVtaXR0ZXJTdWJzY3JpcHRpb24odGhpcywgdGhpcy5fc3Vic2NyaWJlciwgbGlzdGVuZXIsIGNvbnRleHQpXG4gICAgKSA6IGFueSk7XG4gIH1cblxuICAvKipcbiAgICogU2ltaWxhciB0byBhZGRMaXN0ZW5lciwgZXhjZXB0IHRoYXQgdGhlIGxpc3RlbmVyIGlzIHJlbW92ZWQgYWZ0ZXIgaXQgaXNcbiAgICogaW52b2tlZCBvbmNlLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gbGlzdGVuIHRvXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGxpc3RlbmVyIC0gRnVuY3Rpb24gdG8gaW52b2tlIG9ubHkgb25jZSB3aGVuIHRoZVxuICAgKiAgIHNwZWNpZmllZCBldmVudCBpcyBlbWl0dGVkXG4gICAqIEBwYXJhbSB7Kn0gY29udGV4dCAtIE9wdGlvbmFsIGNvbnRleHQgb2JqZWN0IHRvIHVzZSB3aGVuIGludm9raW5nIHRoZVxuICAgKiAgIGxpc3RlbmVyXG4gICAqL1xuICBvbmNlKGV2ZW50VHlwZTogc3RyaW5nLCBsaXN0ZW5lcjogRnVuY3Rpb24sIGNvbnRleHQ6ID9PYmplY3QpOiBFbWl0dGVyU3Vic2NyaXB0aW9uIHtcbiAgICByZXR1cm4gdGhpcy5hZGRMaXN0ZW5lcihldmVudFR5cGUsICguLi5hcmdzKSA9PiB7XG4gICAgICB0aGlzLnJlbW92ZUN1cnJlbnRMaXN0ZW5lcigpO1xuICAgICAgbGlzdGVuZXIuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhbGwgb2YgdGhlIHJlZ2lzdGVyZWQgbGlzdGVuZXJzLCBpbmNsdWRpbmcgdGhvc2UgcmVnaXN0ZXJlZCBhc1xuICAgKiBsaXN0ZW5lciBtYXBzLlxuICAgKlxuICAgKiBAcGFyYW0gez9zdHJpbmd9IGV2ZW50VHlwZSAtIE9wdGlvbmFsIG5hbWUgb2YgdGhlIGV2ZW50IHdob3NlIHJlZ2lzdGVyZWRcbiAgICogICBsaXN0ZW5lcnMgdG8gcmVtb3ZlXG4gICAqL1xuICByZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnRUeXBlOiA/c3RyaW5nKSB7XG4gICAgdGhpcy5fc3Vic2NyaWJlci5yZW1vdmVBbGxTdWJzY3JpcHRpb25zKGV2ZW50VHlwZSk7XG4gIH1cblxuICAvKipcbiAgICogUHJvdmlkZXMgYW4gQVBJIHRoYXQgY2FuIGJlIGNhbGxlZCBkdXJpbmcgYW4gZXZlbnRpbmcgY3ljbGUgdG8gcmVtb3ZlIHRoZVxuICAgKiBsYXN0IGxpc3RlbmVyIHRoYXQgd2FzIGludm9rZWQuIFRoaXMgYWxsb3dzIGEgZGV2ZWxvcGVyIHRvIHByb3ZpZGUgYW4gZXZlbnRcbiAgICogb2JqZWN0IHRoYXQgY2FuIHJlbW92ZSB0aGUgbGlzdGVuZXIgKG9yIGxpc3RlbmVyIG1hcCkgZHVyaW5nIHRoZVxuICAgKiBpbnZvY2F0aW9uLlxuICAgKlxuICAgKiBJZiBpdCBpcyBjYWxsZWQgd2hlbiBub3QgaW5zaWRlIG9mIGFuIGVtaXR0aW5nIGN5Y2xlIGl0IHdpbGwgdGhyb3cuXG4gICAqXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBXaGVuIGNhbGxlZCBub3QgZHVyaW5nIGFuIGV2ZW50aW5nIGN5Y2xlXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqICAgdmFyIHN1YnNjcmlwdGlvbiA9IGVtaXR0ZXIuYWRkTGlzdGVuZXJNYXAoe1xuICAgKiAgICAgc29tZUV2ZW50OiBmdW5jdGlvbihkYXRhLCBldmVudCkge1xuICAgKiAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICogICAgICAgZW1pdHRlci5yZW1vdmVDdXJyZW50TGlzdGVuZXIoKTtcbiAgICogICAgIH1cbiAgICogICB9KTtcbiAgICpcbiAgICogICBlbWl0dGVyLmVtaXQoJ3NvbWVFdmVudCcsICdhYmMnKTsgLy8gbG9ncyAnYWJjJ1xuICAgKiAgIGVtaXR0ZXIuZW1pdCgnc29tZUV2ZW50JywgJ2RlZicpOyAvLyBkb2VzIG5vdCBsb2cgYW55dGhpbmdcbiAgICovXG4gIHJlbW92ZUN1cnJlbnRMaXN0ZW5lcigpIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhIXRoaXMuX2N1cnJlbnRTdWJzY3JpcHRpb24sXG4gICAgICAnTm90IGluIGFuIGVtaXR0aW5nIGN5Y2xlOyB0aGVyZSBpcyBubyBjdXJyZW50IHN1YnNjcmlwdGlvbidcbiAgICApO1xuICAgIHRoaXMucmVtb3ZlU3Vic2NyaXB0aW9uKHRoaXMuX2N1cnJlbnRTdWJzY3JpcHRpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYSBzcGVjaWZpYyBzdWJzY3JpcHRpb24uIENhbGxlZCBieSB0aGUgYHJlbW92ZSgpYCBtZXRob2Qgb2YgdGhlXG4gICAqIHN1YnNjcmlwdGlvbiBpdHNlbGYgdG8gZW5zdXJlIGFueSBuZWNlc3NhcnkgY2xlYW51cCBpcyBwZXJmb3JtZWQuXG4gICAqL1xuICByZW1vdmVTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uOiBFbWl0dGVyU3Vic2NyaXB0aW9uKSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgc3Vic2NyaXB0aW9uLmVtaXR0ZXIgPT09IHRoaXMsXG4gICAgICAnU3Vic2NyaXB0aW9uIGRvZXMgbm90IGJlbG9uZyB0byB0aGlzIGVtaXR0ZXIuJ1xuICAgICk7XG4gICAgdGhpcy5fc3Vic2NyaWJlci5yZW1vdmVTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIGFycmF5IG9mIGxpc3RlbmVycyB0aGF0IGFyZSBjdXJyZW50bHkgcmVnaXN0ZXJlZCBmb3IgdGhlIGdpdmVuXG4gICAqIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gcXVlcnlcbiAgICogQHJldHVybnMge2FycmF5fVxuICAgKi9cbiAgbGlzdGVuZXJzKGV2ZW50VHlwZTogc3RyaW5nKTogW0VtaXR0ZXJTdWJzY3JpcHRpb25dIHtcbiAgICBjb25zdCBzdWJzY3JpcHRpb25zOiA/W0VtaXR0ZXJTdWJzY3JpcHRpb25dID0gKHRoaXMuX3N1YnNjcmliZXIuZ2V0U3Vic2NyaXB0aW9uc0ZvclR5cGUoZXZlbnRUeXBlKTogYW55KTtcbiAgICByZXR1cm4gc3Vic2NyaXB0aW9uc1xuICAgICAgPyBzdWJzY3JpcHRpb25zLmZpbHRlcihlbXB0eUZ1bmN0aW9uLnRoYXRSZXR1cm5zVHJ1ZSkubWFwKFxuICAgICAgICAgIGZ1bmN0aW9uKHN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbi5saXN0ZW5lcjtcbiAgICAgICAgICB9KVxuICAgICAgOiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbWl0cyBhbiBldmVudCBvZiB0aGUgZ2l2ZW4gdHlwZSB3aXRoIHRoZSBnaXZlbiBkYXRhLiBBbGwgaGFuZGxlcnMgb2YgdGhhdFxuICAgKiBwYXJ0aWN1bGFyIHR5cGUgd2lsbCBiZSBub3RpZmllZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50VHlwZSAtIE5hbWUgb2YgdGhlIGV2ZW50IHRvIGVtaXRcbiAgICogQHBhcmFtIHsuLi4qfSBBcmJpdHJhcnkgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byBlYWNoIHJlZ2lzdGVyZWQgbGlzdGVuZXJcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogICBlbWl0dGVyLmFkZExpc3RlbmVyKCdzb21lRXZlbnQnLCBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAqICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICogICB9KTtcbiAgICpcbiAgICogICBlbWl0dGVyLmVtaXQoJ3NvbWVFdmVudCcsICdhYmMnKTsgLy8gbG9ncyAnYWJjJ1xuICAgKi9cbiAgZW1pdChldmVudFR5cGU6IHN0cmluZykge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbnM6ID9bRW1pdHRlclN1YnNjcmlwdGlvbl0gPSAodGhpcy5fc3Vic2NyaWJlci5nZXRTdWJzY3JpcHRpb25zRm9yVHlwZShldmVudFR5cGUpOiBhbnkpO1xuICAgIGlmIChzdWJzY3JpcHRpb25zKSB7XG4gICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHN1YnNjcmlwdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHN1YnNjcmlwdGlvbnNbaV07XG5cbiAgICAgICAgLy8gVGhlIHN1YnNjcmlwdGlvbiBtYXkgaGF2ZSBiZWVuIHJlbW92ZWQgZHVyaW5nIHRoaXMgZXZlbnQgbG9vcC5cbiAgICAgICAgaWYgKHN1YnNjcmlwdGlvbikge1xuICAgICAgICAgIHRoaXMuX2N1cnJlbnRTdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb247XG4gICAgICAgICAgc3Vic2NyaXB0aW9uLmxpc3RlbmVyLmFwcGx5KFxuICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmNvbnRleHQsXG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5fY3VycmVudFN1YnNjcmlwdGlvbiA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgdGhlIGdpdmVuIGxpc3RlbmVyIGZvciBldmVudCBvZiBzcGVjaWZpYyB0eXBlLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gZW1pdFxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBsaXN0ZW5lciAtIEZ1bmN0aW9uIHRvIGludm9rZSB3aGVuIHRoZSBzcGVjaWZpZWQgZXZlbnQgaXNcbiAgICogICBlbWl0dGVkXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqICAgZW1pdHRlci5yZW1vdmVMaXN0ZW5lcignc29tZUV2ZW50JywgZnVuY3Rpb24obWVzc2FnZSkge1xuICAgKiAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gICAqICAgfSk7IC8vIHJlbW92ZXMgdGhlIGxpc3RlbmVyIGlmIGFscmVhZHkgcmVnaXN0ZXJlZFxuICAgKlxuICAgKi9cbiAgcmVtb3ZlTGlzdGVuZXIoZXZlbnRUeXBlOiBTdHJpbmcsIGxpc3RlbmVyKSB7XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uczogP1tFbWl0dGVyU3Vic2NyaXB0aW9uXSA9ICh0aGlzLl9zdWJzY3JpYmVyLmdldFN1YnNjcmlwdGlvbnNGb3JUeXBlKGV2ZW50VHlwZSk6IGFueSk7XG4gICAgaWYgKHN1YnNjcmlwdGlvbnMpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gc3Vic2NyaXB0aW9ucy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gc3Vic2NyaXB0aW9uc1tpXTtcblxuICAgICAgICAvLyBUaGUgc3Vic2NyaXB0aW9uIG1heSBoYXZlIGJlZW4gcmVtb3ZlZCBkdXJpbmcgdGhpcyBldmVudCBsb29wLlxuICAgICAgICAvLyBpdHMgbGlzdGVuZXIgbWF0Y2hlcyB0aGUgbGlzdGVuZXIgaW4gbWV0aG9kIHBhcmFtZXRlcnNcbiAgICAgICAgaWYgKHN1YnNjcmlwdGlvbiAmJiBzdWJzY3JpcHRpb24ubGlzdGVuZXIgPT09IGxpc3RlbmVyKSB7XG4gICAgICAgICAgc3Vic2NyaXB0aW9uLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyO1xuIl19