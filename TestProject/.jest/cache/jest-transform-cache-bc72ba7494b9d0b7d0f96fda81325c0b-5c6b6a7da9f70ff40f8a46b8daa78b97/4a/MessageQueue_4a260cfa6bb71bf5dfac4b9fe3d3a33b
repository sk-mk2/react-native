eac3ee8705af9584096ac3439ed70002
'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var ErrorUtils=require('ErrorUtils');var Systrace=require('Systrace');var deepFreezeAndThrowOnMutationInDev=require('deepFreezeAndThrowOnMutationInDev');var invariant=require('fbjs/lib/invariant');var stringifySafe=require('stringifySafe');var TO_JS=0;var TO_NATIVE=1;var MODULE_IDS=0;var METHOD_IDS=1;var PARAMS=2;var MIN_TIME_BETWEEN_FLUSHES_MS=5;var TRACE_TAG_REACT_APPS=1<<17;var DEBUG_INFO_LIMIT=32;var JSTimers=null;var MessageQueue=function(){function MessageQueue(){var shouldUninstallGlobalErrorHandler=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classCallCheck(this,MessageQueue);this._lazyCallableModules={};this._queue=[[],[],[],0];this._successCallbacks=[];this._failureCallbacks=[];this._callID=0;this._lastFlush=0;this._eventLoopStartTime=new Date().getTime();if(shouldUninstallGlobalErrorHandler){this.uninstallGlobalErrorHandler();}else{this.installGlobalErrorHandler();}if(__DEV__){this._debugInfo={};this._remoteModuleTable={};this._remoteMethodTable={};}this.callFunctionReturnFlushedQueue=this.callFunctionReturnFlushedQueue.bind(this);this.callFunctionReturnResultAndFlushedQueue=this.callFunctionReturnResultAndFlushedQueue.bind(this);this.flushedQueue=this.flushedQueue.bind(this);this.invokeCallbackAndReturnFlushedQueue=this.invokeCallbackAndReturnFlushedQueue.bind(this);}_createClass(MessageQueue,[{key:'callFunctionReturnFlushedQueue',value:function callFunctionReturnFlushedQueue(module,method,args){var _this=this;this.__guard(function(){_this.__callFunction(module,method,args);});return this.flushedQueue();}},{key:'callFunctionReturnResultAndFlushedQueue',value:function callFunctionReturnResultAndFlushedQueue(module,method,args){var _this2=this;var result=void 0;this.__guard(function(){result=_this2.__callFunction(module,method,args);});return[result,this.flushedQueue()];}},{key:'invokeCallbackAndReturnFlushedQueue',value:function invokeCallbackAndReturnFlushedQueue(cbID,args){var _this3=this;this.__guard(function(){_this3.__invokeCallback(cbID,args);});return this.flushedQueue();}},{key:'flushedQueue',value:function flushedQueue(){var _this4=this;this.__guard(function(){_this4.__callImmediates();});var queue=this._queue;this._queue=[[],[],[],this._callID];return queue[0].length?queue:null;}},{key:'getEventLoopRunningTime',value:function getEventLoopRunningTime(){return new Date().getTime()-this._eventLoopStartTime;}},{key:'registerCallableModule',value:function registerCallableModule(name,module){this._lazyCallableModules[name]=function(){return module;};}},{key:'registerLazyCallableModule',value:function registerLazyCallableModule(name,factory){var module=void 0;var getValue=factory;this._lazyCallableModules[name]=function(){if(getValue){module=getValue();getValue=null;}return module;};}},{key:'getCallableModule',value:function getCallableModule(name){var getValue=this._lazyCallableModules[name];return getValue?getValue():null;}},{key:'enqueueNativeCall',value:function enqueueNativeCall(moduleID,methodID,params,onFail,onSucc){if(onFail||onSucc){if(__DEV__){this._debugInfo[this._callID]=[moduleID,methodID];if(this._callID>DEBUG_INFO_LIMIT){delete this._debugInfo[this._callID-DEBUG_INFO_LIMIT];}}onFail&&params.push(this._callID<<1);onSucc&&params.push(this._callID<<1|1);this._successCallbacks[this._callID]=onSucc;this._failureCallbacks[this._callID]=onFail;}if(__DEV__){global.nativeTraceBeginAsyncFlow&&global.nativeTraceBeginAsyncFlow(TRACE_TAG_REACT_APPS,'native',this._callID);}this._callID++;this._queue[MODULE_IDS].push(moduleID);this._queue[METHOD_IDS].push(methodID);if(__DEV__){var isValidArgument=function isValidArgument(val){var t=typeof val;if(t==='undefined'||t==='null'||t==='boolean'||t==='number'||t==='string'){return true;}if(t==='function'||t!=='object'){return false;}if(Array.isArray(val)){return val.every(isValidArgument);}for(var k in val){if(typeof val[k]!=='function'&&!isValidArgument(val[k])){return false;}}return true;};invariant(isValidArgument(params),'%s is not usable as a native method argument',params);deepFreezeAndThrowOnMutationInDev(params);}this._queue[PARAMS].push(params);var now=new Date().getTime();if(global.nativeFlushQueueImmediate&&(now-this._lastFlush>=MIN_TIME_BETWEEN_FLUSHES_MS||this._inCall===0)){var queue=this._queue;this._queue=[[],[],[],this._callID];this._lastFlush=now;global.nativeFlushQueueImmediate(queue);}Systrace.counterEvent('pending_js_to_native_queue',this._queue[0].length);if(__DEV__&&this.__spy&&isFinite(moduleID)){this.__spy({type:TO_NATIVE,module:this._remoteModuleTable[moduleID],method:this._remoteMethodTable[moduleID][methodID],args:params});}else if(this.__spy){this.__spy({type:TO_NATIVE,module:moduleID+'',method:methodID,args:params});}}},{key:'createDebugLookup',value:function createDebugLookup(moduleID,name,methods){if(__DEV__){this._remoteModuleTable[moduleID]=name;this._remoteMethodTable[moduleID]=methods;}}},{key:'uninstallGlobalErrorHandler',value:function uninstallGlobalErrorHandler(){this.__guard=this.__guardUnsafe;}},{key:'installGlobalErrorHandler',value:function installGlobalErrorHandler(){this.__guard=this.__guardSafe;}},{key:'__guardUnsafe',value:function __guardUnsafe(fn){this._inCall++;fn();this._inCall--;}},{key:'__guardSafe',value:function __guardSafe(fn){this._inCall++;try{fn();}catch(error){ErrorUtils.reportFatalError(error);}finally{this._inCall--;}}},{key:'__callImmediates',value:function __callImmediates(){Systrace.beginEvent('JSTimers.callImmediates()');if(!JSTimers){JSTimers=require('JSTimers');}JSTimers.callImmediates();Systrace.endEvent();}},{key:'__callFunction',value:function __callFunction(module,method,args){this._lastFlush=new Date().getTime();this._eventLoopStartTime=this._lastFlush;Systrace.beginEvent(module+'.'+method+'()');if(this.__spy){this.__spy({type:TO_JS,module:module,method:method,args:args});}var moduleMethods=this.getCallableModule(module);invariant(!!moduleMethods,'Module %s is not a registered callable module (calling %s)',module,method);invariant(!!moduleMethods[method],'Method %s does not exist on module %s',method,module);var result=moduleMethods[method].apply(moduleMethods,args);Systrace.endEvent();return result;}},{key:'__invokeCallback',value:function __invokeCallback(cbID,args){this._lastFlush=new Date().getTime();this._eventLoopStartTime=this._lastFlush;var callID=cbID>>>1;var isSuccess=cbID&1;var callback=isSuccess?this._successCallbacks[callID]:this._failureCallbacks[callID];if(__DEV__){var debug=this._debugInfo[callID];var _module=debug&&this._remoteModuleTable[debug[0]];var _method=debug&&this._remoteMethodTable[debug[0]][debug[1]];if(!callback){var errorMessage='Callback with id '+cbID+': '+_module+'.'+_method+'() not found';if(_method){errorMessage='The callback '+_method+'() exists in module '+_module+', '+'but only one callback may be registered to a function in a native module.';}invariant(callback,errorMessage);}var profileName=debug?'<callback for '+_module+'.'+_method+'>':cbID;if(callback&&this.__spy){this.__spy({type:TO_JS,module:null,method:profileName,args:args});}Systrace.beginEvent('MessageQueue.invokeCallback('+profileName+', '+stringifySafe(args)+')');}if(!callback){return;}this._successCallbacks[callID]=this._failureCallbacks[callID]=null;callback.apply(undefined,_toConsumableArray(args));if(__DEV__){Systrace.endEvent();}}}],[{key:'spy',value:function spy(spyOrToggle){if(spyOrToggle===true){MessageQueue.prototype.__spy=function(info){console.log((info.type===TO_JS?'N->JS':'JS->N')+' : '+(''+(info.module?info.module+'.':'')+info.method)+('('+JSON.stringify(info.args)+')'));};}else if(spyOrToggle===false){MessageQueue.prototype.__spy=null;}else{MessageQueue.prototype.__spy=spyOrToggle;}}}]);return MessageQueue;}();module.exports=MessageQueue;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1lc3NhZ2VRdWV1ZS5qcyJdLCJuYW1lcyI6WyJFcnJvclV0aWxzIiwicmVxdWlyZSIsIlN5c3RyYWNlIiwiZGVlcEZyZWV6ZUFuZFRocm93T25NdXRhdGlvbkluRGV2IiwiaW52YXJpYW50Iiwic3RyaW5naWZ5U2FmZSIsIlRPX0pTIiwiVE9fTkFUSVZFIiwiTU9EVUxFX0lEUyIsIk1FVEhPRF9JRFMiLCJQQVJBTVMiLCJNSU5fVElNRV9CRVRXRUVOX0ZMVVNIRVNfTVMiLCJUUkFDRV9UQUdfUkVBQ1RfQVBQUyIsIkRFQlVHX0lORk9fTElNSVQiLCJKU1RpbWVycyIsIk1lc3NhZ2VRdWV1ZSIsInNob3VsZFVuaW5zdGFsbEdsb2JhbEVycm9ySGFuZGxlciIsIl9sYXp5Q2FsbGFibGVNb2R1bGVzIiwiX3F1ZXVlIiwiX3N1Y2Nlc3NDYWxsYmFja3MiLCJfZmFpbHVyZUNhbGxiYWNrcyIsIl9jYWxsSUQiLCJfbGFzdEZsdXNoIiwiX2V2ZW50TG9vcFN0YXJ0VGltZSIsIkRhdGUiLCJnZXRUaW1lIiwidW5pbnN0YWxsR2xvYmFsRXJyb3JIYW5kbGVyIiwiaW5zdGFsbEdsb2JhbEVycm9ySGFuZGxlciIsIl9fREVWX18iLCJfZGVidWdJbmZvIiwiX3JlbW90ZU1vZHVsZVRhYmxlIiwiX3JlbW90ZU1ldGhvZFRhYmxlIiwiY2FsbEZ1bmN0aW9uUmV0dXJuRmx1c2hlZFF1ZXVlIiwiYmluZCIsImNhbGxGdW5jdGlvblJldHVyblJlc3VsdEFuZEZsdXNoZWRRdWV1ZSIsImZsdXNoZWRRdWV1ZSIsImludm9rZUNhbGxiYWNrQW5kUmV0dXJuRmx1c2hlZFF1ZXVlIiwibW9kdWxlIiwibWV0aG9kIiwiYXJncyIsIl9fZ3VhcmQiLCJfX2NhbGxGdW5jdGlvbiIsInJlc3VsdCIsImNiSUQiLCJfX2ludm9rZUNhbGxiYWNrIiwiX19jYWxsSW1tZWRpYXRlcyIsInF1ZXVlIiwibGVuZ3RoIiwibmFtZSIsImZhY3RvcnkiLCJnZXRWYWx1ZSIsIm1vZHVsZUlEIiwibWV0aG9kSUQiLCJwYXJhbXMiLCJvbkZhaWwiLCJvblN1Y2MiLCJwdXNoIiwiZ2xvYmFsIiwibmF0aXZlVHJhY2VCZWdpbkFzeW5jRmxvdyIsImlzVmFsaWRBcmd1bWVudCIsInQiLCJ2YWwiLCJBcnJheSIsImlzQXJyYXkiLCJldmVyeSIsImsiLCJub3ciLCJuYXRpdmVGbHVzaFF1ZXVlSW1tZWRpYXRlIiwiX2luQ2FsbCIsImNvdW50ZXJFdmVudCIsIl9fc3B5IiwiaXNGaW5pdGUiLCJ0eXBlIiwibWV0aG9kcyIsIl9fZ3VhcmRVbnNhZmUiLCJfX2d1YXJkU2FmZSIsImZuIiwiZXJyb3IiLCJyZXBvcnRGYXRhbEVycm9yIiwiYmVnaW5FdmVudCIsImNhbGxJbW1lZGlhdGVzIiwiZW5kRXZlbnQiLCJtb2R1bGVNZXRob2RzIiwiZ2V0Q2FsbGFibGVNb2R1bGUiLCJhcHBseSIsImNhbGxJRCIsImlzU3VjY2VzcyIsImNhbGxiYWNrIiwiZGVidWciLCJlcnJvck1lc3NhZ2UiLCJwcm9maWxlTmFtZSIsInNweU9yVG9nZ2xlIiwicHJvdG90eXBlIiwiY29uc29sZSIsImxvZyIsImluZm8iLCJKU09OIiwic3RyaW5naWZ5IiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBV0EsYSx1ekJBRUEsR0FBTUEsWUFBYUMsT0FBYixjQUFOLENBQ0EsR0FBTUMsVUFBV0QsT0FBWCxZQUFOLENBRUEsR0FBTUUsbUNBQW9DRixPQUFwQyxxQ0FBTixDQUNBLEdBQU1HLFdBQVlILE9BQVosc0JBQU4sQ0FDQSxHQUFNSSxlQUFnQkosT0FBaEIsaUJBQU4sQ0FTQSxHQUFNSyxPQUFRLENBQWQsQ0FDQSxHQUFNQyxXQUFZLENBQWxCLENBRUEsR0FBTUMsWUFBYSxDQUFuQixDQUNBLEdBQU1DLFlBQWEsQ0FBbkIsQ0FDQSxHQUFNQyxRQUFTLENBQWYsQ0FDQSxHQUFNQyw2QkFBOEIsQ0FBcEMsQ0FHQSxHQUFNQyxzQkFBdUIsR0FBSyxFQUFsQyxDQUVBLEdBQU1DLGtCQUFtQixFQUF6QixDQUdBLEdBQUlDLFVBQVcsSUFBZixDLEdBRU1D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a0MsSUFBZCxDQURqRCxNQUdELENBRUQsR0FBSSxDQUFDZ0QsUUFBTCxDQUFlLENBQ2IsT0FDRCxDQUVELEtBQUtwRSxpQkFBTCxDQUF1QmtFLE1BQXZCLEVBQWlDLEtBQUtqRSxpQkFBTCxDQUF1QmlFLE1BQXZCLEVBQWlDLElBQWxFLENBQ0FFLDRDQUFZaEQsSUFBWixHQUVBLEdBQUlYLE9BQUosQ0FBYSxDQUNYMUIsU0FBUytFLFFBQVQsR0FDRCxDQUNGLEMsa0NBalRVVSxXLENBQWtELENBQzNELEdBQUlBLGNBQWdCLElBQXBCLENBQTBCLENBQ3hCNUUsYUFBYTZFLFNBQWIsQ0FBdUJ0QixLQUF2QixDQUErQixjQUFRLENBQ3JDdUIsUUFBUUMsR0FBUixDQUNFLENBQUdDLEtBQUt2QixJQUFMLEdBQWNsRSxLQUFkLENBQXNCLE9BQXRCLENBQWdDLE9BQW5DLGFBQ0t5RixLQUFLMUQsTUFBTCxDQUFjMEQsS0FBSzFELE1BQUwsQ0FBYyxHQUE1QixDQUFrQyxFQUR2QyxFQUM0QzBELEtBQUt6RCxNQURqRCxPQUVNMEQsS0FBS0MsU0FBTCxDQUFlRixLQUFLeEQsSUFBcEIsQ0FGTixLQURGLEVBS0QsQ0FORCxDQU9ELENBUkQsSUFRTyxJQUFJb0QsY0FBZ0IsS0FBcEIsQ0FBMkIsQ0FDaEM1RSxhQUFhNkUsU0FBYixDQUF1QnRCLEtBQXZCLENBQStCLElBQS9CLENBQ0QsQ0FGTSxJQUVBLENBQ0x2RCxhQUFhNkUsU0FBYixDQUF1QnRCLEtBQXZCLENBQStCcUIsV0FBL0IsQ0FDRCxDQUNGLEMsNEJBc1NIdEQsT0FBTzZELE9BQVAsQ0FBaUJuRixZQUFqQiIsImZpbGUiOiJNZXNzYWdlUXVldWUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBwcm92aWRlc01vZHVsZSBNZXNzYWdlUXVldWVcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBFcnJvclV0aWxzID0gcmVxdWlyZSgnRXJyb3JVdGlscycpO1xuY29uc3QgU3lzdHJhY2UgPSByZXF1aXJlKCdTeXN0cmFjZScpO1xuXG5jb25zdCBkZWVwRnJlZXplQW5kVGhyb3dPbk11dGF0aW9uSW5EZXYgPSByZXF1aXJlKCdkZWVwRnJlZXplQW5kVGhyb3dPbk11dGF0aW9uSW5EZXYnKTtcbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ZianMvbGliL2ludmFyaWFudCcpO1xuY29uc3Qgc3RyaW5naWZ5U2FmZSA9IHJlcXVpcmUoJ3N0cmluZ2lmeVNhZmUnKTtcblxuZXhwb3J0IHR5cGUgU3B5RGF0YSA9IHtcbiAgdHlwZTogbnVtYmVyLFxuICBtb2R1bGU6ID9zdHJpbmcsXG4gIG1ldGhvZDogc3RyaW5nIHwgbnVtYmVyLFxuICBhcmdzOiBhbnlbXSxcbn07XG5cbmNvbnN0IFRPX0pTID0gMDtcbmNvbnN0IFRPX05BVElWRSA9IDE7XG5cbmNvbnN0IE1PRFVMRV9JRFMgPSAwO1xuY29uc3QgTUVUSE9EX0lEUyA9IDE7XG5jb25zdCBQQVJBTVMgPSAyO1xuY29uc3QgTUlOX1RJTUVfQkVUV0VFTl9GTFVTSEVTX01TID0gNTtcblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2VcbmNvbnN0IFRSQUNFX1RBR19SRUFDVF9BUFBTID0gMSA8PCAxNztcblxuY29uc3QgREVCVUdfSU5GT19MSU1JVCA9IDMyO1xuXG4vLyBXb3JrIGFyb3VuZCBhbiBpbml0aWFsaXphdGlvbiBvcmRlciBpc3N1ZVxubGV0IEpTVGltZXJzID0gbnVsbDtcblxuY2xhc3MgTWVzc2FnZVF1ZXVlIHtcbiAgX2xhenlDYWxsYWJsZU1vZHVsZXM6IHtba2V5OiBzdHJpbmddOiAodm9pZCkgPT4gT2JqZWN0fTtcbiAgX3F1ZXVlOiBbbnVtYmVyW10sIG51bWJlcltdLCBhbnlbXSwgbnVtYmVyXTtcbiAgX3N1Y2Nlc3NDYWxsYmFja3M6ICg/RnVuY3Rpb24pW107XG4gIF9mYWlsdXJlQ2FsbGJhY2tzOiAoP0Z1bmN0aW9uKVtdO1xuICBfY2FsbElEOiBudW1iZXI7XG4gIF9pbkNhbGw6IG51bWJlcjtcbiAgX2xhc3RGbHVzaDogbnVtYmVyO1xuICBfZXZlbnRMb29wU3RhcnRUaW1lOiBudW1iZXI7XG5cbiAgX2RlYnVnSW5mbzoge1tudW1iZXJdOiBbbnVtYmVyLCBudW1iZXJdfTtcbiAgX3JlbW90ZU1vZHVsZVRhYmxlOiB7W251bWJlcl06IHN0cmluZ307XG4gIF9yZW1vdGVNZXRob2RUYWJsZToge1tudW1iZXJdOiBzdHJpbmdbXX07XG5cbiAgX19zcHk6ID8oZGF0YTogU3B5RGF0YSkgPT4gdm9pZDtcblxuICBfX2d1YXJkOiAoKCkgPT4gdm9pZCkgPT4gdm9pZDtcblxuICBjb25zdHJ1Y3RvcihzaG91bGRVbmluc3RhbGxHbG9iYWxFcnJvckhhbmRsZXI6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgIHRoaXMuX2xhenlDYWxsYWJsZU1vZHVsZXMgPSB7fTtcbiAgICB0aGlzLl9xdWV1ZSA9IFtbXSwgW10sIFtdLCAwXTtcbiAgICB0aGlzLl9zdWNjZXNzQ2FsbGJhY2tzID0gW107XG4gICAgdGhpcy5fZmFpbHVyZUNhbGxiYWNrcyA9IFtdO1xuICAgIHRoaXMuX2NhbGxJRCA9IDA7XG4gICAgdGhpcy5fbGFzdEZsdXNoID0gMDtcbiAgICB0aGlzLl9ldmVudExvb3BTdGFydFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICBpZiAoc2hvdWxkVW5pbnN0YWxsR2xvYmFsRXJyb3JIYW5kbGVyKSB7XG4gICAgICB0aGlzLnVuaW5zdGFsbEdsb2JhbEVycm9ySGFuZGxlcigpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmluc3RhbGxHbG9iYWxFcnJvckhhbmRsZXIoKTtcbiAgICB9XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgdGhpcy5fZGVidWdJbmZvID0ge307XG4gICAgICB0aGlzLl9yZW1vdGVNb2R1bGVUYWJsZSA9IHt9O1xuICAgICAgdGhpcy5fcmVtb3RlTWV0aG9kVGFibGUgPSB7fTtcbiAgICB9XG5cbiAgICAodGhpczogYW55KS5jYWxsRnVuY3Rpb25SZXR1cm5GbHVzaGVkUXVldWUgPSB0aGlzLmNhbGxGdW5jdGlvblJldHVybkZsdXNoZWRRdWV1ZS5iaW5kKFxuICAgICAgdGhpcyxcbiAgICApO1xuICAgICh0aGlzOiBhbnkpLmNhbGxGdW5jdGlvblJldHVyblJlc3VsdEFuZEZsdXNoZWRRdWV1ZSA9IHRoaXMuY2FsbEZ1bmN0aW9uUmV0dXJuUmVzdWx0QW5kRmx1c2hlZFF1ZXVlLmJpbmQoXG4gICAgICB0aGlzLFxuICAgICk7XG4gICAgKHRoaXM6IGFueSkuZmx1c2hlZFF1ZXVlID0gdGhpcy5mbHVzaGVkUXVldWUuYmluZCh0aGlzKTtcbiAgICAodGhpczogYW55KS5pbnZva2VDYWxsYmFja0FuZFJldHVybkZsdXNoZWRRdWV1ZSA9IHRoaXMuaW52b2tlQ2FsbGJhY2tBbmRSZXR1cm5GbHVzaGVkUXVldWUuYmluZChcbiAgICAgIHRoaXMsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdWJsaWMgQVBJc1xuICAgKi9cblxuICBzdGF0aWMgc3B5KHNweU9yVG9nZ2xlOiBib29sZWFuIHwgKChkYXRhOiBTcHlEYXRhKSA9PiB2b2lkKSkge1xuICAgIGlmIChzcHlPclRvZ2dsZSA9PT0gdHJ1ZSkge1xuICAgICAgTWVzc2FnZVF1ZXVlLnByb3RvdHlwZS5fX3NweSA9IGluZm8gPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBgJHtpbmZvLnR5cGUgPT09IFRPX0pTID8gJ04tPkpTJyA6ICdKUy0+Tid9IDogYCArXG4gICAgICAgICAgICBgJHtpbmZvLm1vZHVsZSA/IGluZm8ubW9kdWxlICsgJy4nIDogJyd9JHtpbmZvLm1ldGhvZH1gICtcbiAgICAgICAgICAgIGAoJHtKU09OLnN0cmluZ2lmeShpbmZvLmFyZ3MpfSlgLFxuICAgICAgICApO1xuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHNweU9yVG9nZ2xlID09PSBmYWxzZSkge1xuICAgICAgTWVzc2FnZVF1ZXVlLnByb3RvdHlwZS5fX3NweSA9IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIE1lc3NhZ2VRdWV1ZS5wcm90b3R5cGUuX19zcHkgPSBzcHlPclRvZ2dsZTtcbiAgICB9XG4gIH1cblxuICBjYWxsRnVuY3Rpb25SZXR1cm5GbHVzaGVkUXVldWUobW9kdWxlOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBhcmdzOiBhbnlbXSkge1xuICAgIHRoaXMuX19ndWFyZCgoKSA9PiB7XG4gICAgICB0aGlzLl9fY2FsbEZ1bmN0aW9uKG1vZHVsZSwgbWV0aG9kLCBhcmdzKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmZsdXNoZWRRdWV1ZSgpO1xuICB9XG5cbiAgY2FsbEZ1bmN0aW9uUmV0dXJuUmVzdWx0QW5kRmx1c2hlZFF1ZXVlKFxuICAgIG1vZHVsZTogc3RyaW5nLFxuICAgIG1ldGhvZDogc3RyaW5nLFxuICAgIGFyZ3M6IGFueVtdLFxuICApIHtcbiAgICBsZXQgcmVzdWx0O1xuICAgIHRoaXMuX19ndWFyZCgoKSA9PiB7XG4gICAgICByZXN1bHQgPSB0aGlzLl9fY2FsbEZ1bmN0aW9uKG1vZHVsZSwgbWV0aG9kLCBhcmdzKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBbcmVzdWx0LCB0aGlzLmZsdXNoZWRRdWV1ZSgpXTtcbiAgfVxuXG4gIGludm9rZUNhbGxiYWNrQW5kUmV0dXJuRmx1c2hlZFF1ZXVlKGNiSUQ6IG51bWJlciwgYXJnczogYW55W10pIHtcbiAgICB0aGlzLl9fZ3VhcmQoKCkgPT4ge1xuICAgICAgdGhpcy5fX2ludm9rZUNhbGxiYWNrKGNiSUQsIGFyZ3MpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuZmx1c2hlZFF1ZXVlKCk7XG4gIH1cblxuICBmbHVzaGVkUXVldWUoKSB7XG4gICAgdGhpcy5fX2d1YXJkKCgpID0+IHtcbiAgICAgIHRoaXMuX19jYWxsSW1tZWRpYXRlcygpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgcXVldWUgPSB0aGlzLl9xdWV1ZTtcbiAgICB0aGlzLl9xdWV1ZSA9IFtbXSwgW10sIFtdLCB0aGlzLl9jYWxsSURdO1xuICAgIHJldHVybiBxdWV1ZVswXS5sZW5ndGggPyBxdWV1ZSA6IG51bGw7XG4gIH1cblxuICBnZXRFdmVudExvb3BSdW5uaW5nVGltZSgpIHtcbiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLl9ldmVudExvb3BTdGFydFRpbWU7XG4gIH1cblxuICByZWdpc3RlckNhbGxhYmxlTW9kdWxlKG5hbWU6IHN0cmluZywgbW9kdWxlOiBPYmplY3QpIHtcbiAgICB0aGlzLl9sYXp5Q2FsbGFibGVNb2R1bGVzW25hbWVdID0gKCkgPT4gbW9kdWxlO1xuICB9XG5cbiAgcmVnaXN0ZXJMYXp5Q2FsbGFibGVNb2R1bGUobmFtZTogc3RyaW5nLCBmYWN0b3J5OiB2b2lkID0+IE9iamVjdCkge1xuICAgIGxldCBtb2R1bGU6IE9iamVjdDtcbiAgICBsZXQgZ2V0VmFsdWU6ID8odm9pZCkgPT4gT2JqZWN0ID0gZmFjdG9yeTtcbiAgICB0aGlzLl9sYXp5Q2FsbGFibGVNb2R1bGVzW25hbWVdID0gKCkgPT4ge1xuICAgICAgaWYgKGdldFZhbHVlKSB7XG4gICAgICAgIG1vZHVsZSA9IGdldFZhbHVlKCk7XG4gICAgICAgIGdldFZhbHVlID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtb2R1bGU7XG4gICAgfTtcbiAgfVxuXG4gIGdldENhbGxhYmxlTW9kdWxlKG5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IGdldFZhbHVlID0gdGhpcy5fbGF6eUNhbGxhYmxlTW9kdWxlc1tuYW1lXTtcbiAgICByZXR1cm4gZ2V0VmFsdWUgPyBnZXRWYWx1ZSgpIDogbnVsbDtcbiAgfVxuXG4gIGVucXVldWVOYXRpdmVDYWxsKFxuICAgIG1vZHVsZUlEOiBudW1iZXIsXG4gICAgbWV0aG9kSUQ6IG51bWJlcixcbiAgICBwYXJhbXM6IGFueVtdLFxuICAgIG9uRmFpbDogP0Z1bmN0aW9uLFxuICAgIG9uU3VjYzogP0Z1bmN0aW9uLFxuICApIHtcbiAgICBpZiAob25GYWlsIHx8IG9uU3VjYykge1xuICAgICAgaWYgKF9fREVWX18pIHtcbiAgICAgICAgdGhpcy5fZGVidWdJbmZvW3RoaXMuX2NhbGxJRF0gPSBbbW9kdWxlSUQsIG1ldGhvZElEXTtcbiAgICAgICAgaWYgKHRoaXMuX2NhbGxJRCA+IERFQlVHX0lORk9fTElNSVQpIHtcbiAgICAgICAgICBkZWxldGUgdGhpcy5fZGVidWdJbmZvW3RoaXMuX2NhbGxJRCAtIERFQlVHX0lORk9fTElNSVRdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBFbmNvZGUgY2FsbElEcyBpbnRvIHBhaXJzIG9mIGNhbGxiYWNrIGlkZW50aWZpZXJzIGJ5IHNoaWZ0aW5nIGxlZnQgYW5kIHVzaW5nIHRoZSByaWdodG1vc3QgYml0XG4gICAgICAvLyB0byBpbmRpY2F0ZSBmYWlsICgwKSBvciBzdWNjZXNzICgxKVxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2VcbiAgICAgIG9uRmFpbCAmJiBwYXJhbXMucHVzaCh0aGlzLl9jYWxsSUQgPDwgMSk7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZVxuICAgICAgb25TdWNjICYmIHBhcmFtcy5wdXNoKCh0aGlzLl9jYWxsSUQgPDwgMSkgfCAxKTtcbiAgICAgIHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3NbdGhpcy5fY2FsbElEXSA9IG9uU3VjYztcbiAgICAgIHRoaXMuX2ZhaWx1cmVDYWxsYmFja3NbdGhpcy5fY2FsbElEXSA9IG9uRmFpbDtcbiAgICB9XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlQmVnaW5Bc3luY0Zsb3cgJiZcbiAgICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlQmVnaW5Bc3luY0Zsb3coXG4gICAgICAgICAgVFJBQ0VfVEFHX1JFQUNUX0FQUFMsXG4gICAgICAgICAgJ25hdGl2ZScsXG4gICAgICAgICAgdGhpcy5fY2FsbElELFxuICAgICAgICApO1xuICAgIH1cbiAgICB0aGlzLl9jYWxsSUQrKztcblxuICAgIHRoaXMuX3F1ZXVlW01PRFVMRV9JRFNdLnB1c2gobW9kdWxlSUQpO1xuICAgIHRoaXMuX3F1ZXVlW01FVEhPRF9JRFNdLnB1c2gobWV0aG9kSUQpO1xuXG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIC8vIFZhbGlkYXRlIHRoYXQgcGFyYW1ldGVycyBwYXNzZWQgb3ZlciB0aGUgYnJpZGdlIGFyZVxuICAgICAgLy8gZm9sbHktY29udmVydGlibGUuICBBcyBhIHNwZWNpYWwgY2FzZSwgaWYgYSBwcm9wIHZhbHVlIGlzIGFcbiAgICAgIC8vIGZ1bmN0aW9uIGl0IGlzIHBlcm1pdHRlZCBoZXJlLCBhbmQgc3BlY2lhbC1jYXNlZCBpbiB0aGVcbiAgICAgIC8vIGNvbnZlcnNpb24uXG4gICAgICBjb25zdCBpc1ZhbGlkQXJndW1lbnQgPSB2YWwgPT4ge1xuICAgICAgICBjb25zdCB0ID0gdHlwZW9mIHZhbDtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHQgPT09ICd1bmRlZmluZWQnIHx8XG4gICAgICAgICAgdCA9PT0gJ251bGwnIHx8XG4gICAgICAgICAgdCA9PT0gJ2Jvb2xlYW4nIHx8XG4gICAgICAgICAgdCA9PT0gJ251bWJlcicgfHxcbiAgICAgICAgICB0ID09PSAnc3RyaW5nJ1xuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodCA9PT0gJ2Z1bmN0aW9uJyB8fCB0ICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWwpKSB7XG4gICAgICAgICAgcmV0dXJuIHZhbC5ldmVyeShpc1ZhbGlkQXJndW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgayBpbiB2YWwpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIHZhbFtrXSAhPT0gJ2Z1bmN0aW9uJyAmJiAhaXNWYWxpZEFyZ3VtZW50KHZhbFtrXSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9O1xuXG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIGlzVmFsaWRBcmd1bWVudChwYXJhbXMpLFxuICAgICAgICAnJXMgaXMgbm90IHVzYWJsZSBhcyBhIG5hdGl2ZSBtZXRob2QgYXJndW1lbnQnLFxuICAgICAgICBwYXJhbXMsXG4gICAgICApO1xuXG4gICAgICAvLyBUaGUgcGFyYW1zIG9iamVjdCBzaG91bGQgbm90IGJlIG11dGF0ZWQgYWZ0ZXIgYmVpbmcgcXVldWVkXG4gICAgICBkZWVwRnJlZXplQW5kVGhyb3dPbk11dGF0aW9uSW5EZXYoKHBhcmFtczogYW55KSk7XG4gICAgfVxuICAgIHRoaXMuX3F1ZXVlW1BBUkFNU10ucHVzaChwYXJhbXMpO1xuXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgaWYgKFxuICAgICAgZ2xvYmFsLm5hdGl2ZUZsdXNoUXVldWVJbW1lZGlhdGUgJiZcbiAgICAgIChub3cgLSB0aGlzLl9sYXN0Rmx1c2ggPj0gTUlOX1RJTUVfQkVUV0VFTl9GTFVTSEVTX01TIHx8XG4gICAgICAgIHRoaXMuX2luQ2FsbCA9PT0gMClcbiAgICApIHtcbiAgICAgIHZhciBxdWV1ZSA9IHRoaXMuX3F1ZXVlO1xuICAgICAgdGhpcy5fcXVldWUgPSBbW10sIFtdLCBbXSwgdGhpcy5fY2FsbElEXTtcbiAgICAgIHRoaXMuX2xhc3RGbHVzaCA9IG5vdztcbiAgICAgIGdsb2JhbC5uYXRpdmVGbHVzaFF1ZXVlSW1tZWRpYXRlKHF1ZXVlKTtcbiAgICB9XG4gICAgU3lzdHJhY2UuY291bnRlckV2ZW50KCdwZW5kaW5nX2pzX3RvX25hdGl2ZV9xdWV1ZScsIHRoaXMuX3F1ZXVlWzBdLmxlbmd0aCk7XG4gICAgaWYgKF9fREVWX18gJiYgdGhpcy5fX3NweSAmJiBpc0Zpbml0ZShtb2R1bGVJRCkpIHtcbiAgICAgIHRoaXMuX19zcHkoe1xuICAgICAgICB0eXBlOiBUT19OQVRJVkUsXG4gICAgICAgIG1vZHVsZTogdGhpcy5fcmVtb3RlTW9kdWxlVGFibGVbbW9kdWxlSURdLFxuICAgICAgICBtZXRob2Q6IHRoaXMuX3JlbW90ZU1ldGhvZFRhYmxlW21vZHVsZUlEXVttZXRob2RJRF0sXG4gICAgICAgIGFyZ3M6IHBhcmFtcyxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fX3NweSkge1xuICAgICAgdGhpcy5fX3NweSh7XG4gICAgICAgIHR5cGU6IFRPX05BVElWRSxcbiAgICAgICAgbW9kdWxlOiBtb2R1bGVJRCArICcnLFxuICAgICAgICBtZXRob2Q6IG1ldGhvZElELFxuICAgICAgICBhcmdzOiBwYXJhbXMsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjcmVhdGVEZWJ1Z0xvb2t1cChtb2R1bGVJRDogbnVtYmVyLCBuYW1lOiBzdHJpbmcsIG1ldGhvZHM6IHN0cmluZ1tdKSB7XG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIHRoaXMuX3JlbW90ZU1vZHVsZVRhYmxlW21vZHVsZUlEXSA9IG5hbWU7XG4gICAgICB0aGlzLl9yZW1vdGVNZXRob2RUYWJsZVttb2R1bGVJRF0gPSBtZXRob2RzO1xuICAgIH1cbiAgfVxuXG4gIHVuaW5zdGFsbEdsb2JhbEVycm9ySGFuZGxlcigpIHtcbiAgICB0aGlzLl9fZ3VhcmQgPSB0aGlzLl9fZ3VhcmRVbnNhZmU7XG4gIH1cblxuICBpbnN0YWxsR2xvYmFsRXJyb3JIYW5kbGVyKCkge1xuICAgIHRoaXMuX19ndWFyZCA9IHRoaXMuX19ndWFyZFNhZmU7XG4gIH1cblxuICAvKipcbiAgICogUHJpdmF0ZSBtZXRob2RzXG4gICAqL1xuXG4gIC8vIExldHMgZXhjZXB0aW9ucyBwcm9wYWdhdGUgdG8gYmUgaGFuZGxlZCBieSB0aGUgVk0gYXQgdGhlIG9yaWdpblxuICBfX2d1YXJkVW5zYWZlKGZuOiAoKSA9PiB2b2lkKSB7XG4gICAgdGhpcy5faW5DYWxsKys7XG4gICAgZm4oKTtcbiAgICB0aGlzLl9pbkNhbGwtLTtcbiAgfVxuXG4gIF9fZ3VhcmRTYWZlKGZuOiAoKSA9PiB2b2lkKSB7XG4gICAgdGhpcy5faW5DYWxsKys7XG4gICAgdHJ5IHtcbiAgICAgIGZuKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIEVycm9yVXRpbHMucmVwb3J0RmF0YWxFcnJvcihlcnJvcik7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMuX2luQ2FsbC0tO1xuICAgIH1cbiAgfVxuXG4gIF9fY2FsbEltbWVkaWF0ZXMoKSB7XG4gICAgU3lzdHJhY2UuYmVnaW5FdmVudCgnSlNUaW1lcnMuY2FsbEltbWVkaWF0ZXMoKScpO1xuICAgIGlmICghSlNUaW1lcnMpIHtcbiAgICAgIEpTVGltZXJzID0gcmVxdWlyZSgnSlNUaW1lcnMnKTtcbiAgICB9XG4gICAgSlNUaW1lcnMuY2FsbEltbWVkaWF0ZXMoKTtcbiAgICBTeXN0cmFjZS5lbmRFdmVudCgpO1xuICB9XG5cbiAgX19jYWxsRnVuY3Rpb24obW9kdWxlOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBhcmdzOiBhbnlbXSk6IGFueSB7XG4gICAgdGhpcy5fbGFzdEZsdXNoID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgdGhpcy5fZXZlbnRMb29wU3RhcnRUaW1lID0gdGhpcy5fbGFzdEZsdXNoO1xuICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQoYCR7bW9kdWxlfS4ke21ldGhvZH0oKWApO1xuICAgIGlmICh0aGlzLl9fc3B5KSB7XG4gICAgICB0aGlzLl9fc3B5KHt0eXBlOiBUT19KUywgbW9kdWxlLCBtZXRob2QsIGFyZ3N9KTtcbiAgICB9XG4gICAgY29uc3QgbW9kdWxlTWV0aG9kcyA9IHRoaXMuZ2V0Q2FsbGFibGVNb2R1bGUobW9kdWxlKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhIW1vZHVsZU1ldGhvZHMsXG4gICAgICAnTW9kdWxlICVzIGlzIG5vdCBhIHJlZ2lzdGVyZWQgY2FsbGFibGUgbW9kdWxlIChjYWxsaW5nICVzKScsXG4gICAgICBtb2R1bGUsXG4gICAgICBtZXRob2QsXG4gICAgKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhIW1vZHVsZU1ldGhvZHNbbWV0aG9kXSxcbiAgICAgICdNZXRob2QgJXMgZG9lcyBub3QgZXhpc3Qgb24gbW9kdWxlICVzJyxcbiAgICAgIG1ldGhvZCxcbiAgICAgIG1vZHVsZSxcbiAgICApO1xuICAgIGNvbnN0IHJlc3VsdCA9IG1vZHVsZU1ldGhvZHNbbWV0aG9kXS5hcHBseShtb2R1bGVNZXRob2RzLCBhcmdzKTtcbiAgICBTeXN0cmFjZS5lbmRFdmVudCgpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBfX2ludm9rZUNhbGxiYWNrKGNiSUQ6IG51bWJlciwgYXJnczogYW55W10pIHtcbiAgICB0aGlzLl9sYXN0Rmx1c2ggPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICB0aGlzLl9ldmVudExvb3BTdGFydFRpbWUgPSB0aGlzLl9sYXN0Rmx1c2g7XG5cbiAgICAvLyBUaGUgcmlnaHRtb3N0IGJpdCBvZiBjYklEIGluZGljYXRlcyBmYWlsICgwKSBvciBzdWNjZXNzICgxKSwgdGhlIG90aGVyIGJpdHMgYXJlIHRoZSBjYWxsSUQgc2hpZnRlZCBsZWZ0LlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlXG4gICAgY29uc3QgY2FsbElEID0gY2JJRCA+Pj4gMTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZVxuICAgIGNvbnN0IGlzU3VjY2VzcyA9IGNiSUQgJiAxO1xuICAgIGNvbnN0IGNhbGxiYWNrID0gaXNTdWNjZXNzXG4gICAgICA/IHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3NbY2FsbElEXVxuICAgICAgOiB0aGlzLl9mYWlsdXJlQ2FsbGJhY2tzW2NhbGxJRF07XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgY29uc3QgZGVidWcgPSB0aGlzLl9kZWJ1Z0luZm9bY2FsbElEXTtcbiAgICAgIGNvbnN0IG1vZHVsZSA9IGRlYnVnICYmIHRoaXMuX3JlbW90ZU1vZHVsZVRhYmxlW2RlYnVnWzBdXTtcbiAgICAgIGNvbnN0IG1ldGhvZCA9IGRlYnVnICYmIHRoaXMuX3JlbW90ZU1ldGhvZFRhYmxlW2RlYnVnWzBdXVtkZWJ1Z1sxXV07XG4gICAgICBpZiAoIWNhbGxiYWNrKSB7XG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSBgQ2FsbGJhY2sgd2l0aCBpZCAke2NiSUR9OiAke21vZHVsZX0uJHttZXRob2R9KCkgbm90IGZvdW5kYDtcbiAgICAgICAgaWYgKG1ldGhvZCkge1xuICAgICAgICAgIGVycm9yTWVzc2FnZSA9XG4gICAgICAgICAgICBgVGhlIGNhbGxiYWNrICR7bWV0aG9kfSgpIGV4aXN0cyBpbiBtb2R1bGUgJHttb2R1bGV9LCBgICtcbiAgICAgICAgICAgICdidXQgb25seSBvbmUgY2FsbGJhY2sgbWF5IGJlIHJlZ2lzdGVyZWQgdG8gYSBmdW5jdGlvbiBpbiBhIG5hdGl2ZSBtb2R1bGUuJztcbiAgICAgICAgfVxuICAgICAgICBpbnZhcmlhbnQoY2FsbGJhY2ssIGVycm9yTWVzc2FnZSk7XG4gICAgICB9XG4gICAgICBjb25zdCBwcm9maWxlTmFtZSA9IGRlYnVnXG4gICAgICAgID8gJzxjYWxsYmFjayBmb3IgJyArIG1vZHVsZSArICcuJyArIG1ldGhvZCArICc+J1xuICAgICAgICA6IGNiSUQ7XG4gICAgICBpZiAoY2FsbGJhY2sgJiYgdGhpcy5fX3NweSkge1xuICAgICAgICB0aGlzLl9fc3B5KHt0eXBlOiBUT19KUywgbW9kdWxlOiBudWxsLCBtZXRob2Q6IHByb2ZpbGVOYW1lLCBhcmdzfSk7XG4gICAgICB9XG4gICAgICBTeXN0cmFjZS5iZWdpbkV2ZW50KFxuICAgICAgICBgTWVzc2FnZVF1ZXVlLmludm9rZUNhbGxiYWNrKCR7cHJvZmlsZU5hbWV9LCAke3N0cmluZ2lmeVNhZmUoYXJncyl9KWAsXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmICghY2FsbGJhY2spIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9zdWNjZXNzQ2FsbGJhY2tzW2NhbGxJRF0gPSB0aGlzLl9mYWlsdXJlQ2FsbGJhY2tzW2NhbGxJRF0gPSBudWxsO1xuICAgIGNhbGxiYWNrKC4uLmFyZ3MpO1xuXG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIFN5c3RyYWNlLmVuZEV2ZW50KCk7XG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gTWVzc2FnZVF1ZXVlO1xuIl19